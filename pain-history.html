<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-card/paper-card.html">
<link rel="import" href="../paper-styles/color.html">
<link rel="import" href="../vaadin-combo-box/vaadin-combo-box.html">
<link rel="import" href="../paper-tags/paper-tags-input.html">
<link rel="import" href="../paper-slider/paper-slider.html">
<link rel="import" href="../paper-typeahead-input/paper-typeahead-input.html">
<link rel="import" href="../iron-a11y-keys/iron-a11y-keys.html">


<!--
`pain-history`
Register anamnesis for people presentig with pain

@demo demo/index.html

toDo:
- Theming
- Typeahead
- Slider
- Tests
- Output
-->

<dom-module id="pain-history">
  <template>
    <style>
      :host {
        --paper-tag-text-color: var(--paper-purple-500);
        --paper-tag-focus-color: var(--paper-purple-50);
      }

      .not-asked{
        color: var(--paper-blue-grey-50);
        background: var(--paper-blue-grey-500);
      }

      .not-present{
        color: var(--paper-indigo-50);
        background: var(--paper-indigo-500);
      }

      .present{
        color: var(--paper-purple-50);
        background: var(--paper-purple-500);
      }
    </style>
    <paper-button id="buttonPain" on-tap="toggle">Pain</paper-button>
    <paper-card hidden$="{{_computeHidden(pain)}}">
      <div class="card-content">
        <!-- <vaadin-combo-box label="Quality" class="languages" items="[[qualities]]" id="dropdownQuality"></vaadin-combo-box> -->
        <paper-tags-input label="Quality" items='[[qualities_selected]]'  maxLength="10"></paper-tags-input>
        <paper-slider min="0" max="10" value="0" label="Intensity" editable pin></paper-slider>
        <iron-a11y-keys id="a11y" target="[[target]]" keys="enter"
                    on-keys-pressed="onEnter"></iron-a11y-keys>
        <paper-typeahead-input id="tagInput" label="Quality" local-candidates="{{qualities}}"
          placeholder="Please enter value" max-suggestions="4" value="{{userInput::input}}">
        </paper-typeahead-input>
      </div>
      <div class="card-actions"></div>
    </paper-card>

  </template>

  <script>
    Polymer({

      is: 'pain-history',

      properties: {
        debug: Boolean,
        pain:{
          type: String,
          reflectToAttribute: true,
          // value: "not-asked",
          notify: true,
          observer: "_painChanged"
        },
        quality: {
          type: String,
          reflectToAttribute: true,
          notify: true
        },
        qualities:{
          type: String,
          value: ["stinging", "burning"]
        },
        qualities_selected:{
          type: String,
          value: [],
          observer: "_qualities_selectedChanged"
        },
        userInput: {
            type: String,
            notify: true,
        },
        target: {
          type: Object,
          value: function() {
            return this.$.tagInput;
          }
        },
      },
      ready: function() {
        console.log(this.debug);
        if(this.debug){console.log(this.pain)};
        return(this.pain = "not-asked");
      },
      onEnter: function() {
        console.log(this.userInput);
        this.qualities_selected.push(this.userInput);
        console.log(this.qualities_selected);
      },
      toggle: function() {
        if(this.debug){console.log("Value Pain:" + this.pain)};
        if(this.debug){console.log("#button-pain toggeled")};
        if(this.pain=="not-asked"){
          this.pain = "not-present";
          if(this.debug){console.log("-pain:"+this.pain)};
          return(this.pain, this._hidden)
        };
        if(this.pain=="not-present"){
          this.pain = "present";
          if(this.debug){console.log("-pain:"+this.pain)};
          return(this.pain)
        };
        if(this.pain=="present"){
          this.pain = "not-asked";
          if(this.debug){console.log("-pain:"+this.pain)};
          return(this.pain);
        };
      },
      _painChanged: function(newValue, oldValue) {
        if(this.debug){console.log("#Compute class:" + this.pain)};
        this.$.buttonPain.toggleClass(oldValue);
        this.$.buttonPain.toggleClass(newValue);
      },
      _computeHidden: function(){
        return(!(this.pain === "present"));
      },
      _qualities_selectedChanged: function(){
        console.log(this.qualities_selected)
      }

    });
  </script>
</dom-module>
